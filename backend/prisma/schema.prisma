// ==========================================
// ğŸ—ƒï¸ MYQUEST - SCHÃ‰MA DE BASE DE DONNÃ‰ES
// ==========================================
//
// Ce fichier dÃ©finit la structure de notre base PostgreSQL.
// Prisma utilise ce schÃ©ma pour:
// - CrÃ©er/modifier les tables (migrations)
// - GÃ©nÃ©rer le client TypeScript typÃ©
//
// COMMANDES UTILES:
// - npx prisma migrate dev    â†’ CrÃ©e une migration + applique
// - npx prisma db push        â†’ Applique sans crÃ©er de migration (dev)
// - npx prisma studio         â†’ Interface web pour voir les donnÃ©es
// - npx prisma generate       â†’ RÃ©gÃ©nÃ¨re le client aprÃ¨s modif
//
// RELATIONS:
// User â†â”€â”€â”¬â”€â”€â†’ Avatar  (1:1 - chaque user a UN avatar)
//         â””â”€â”€â†’ Stats   (1:1 - chaque user a UNE ligne de stats)

// ============================================
// âš™ï¸ CONFIGURATION PRISMA
// ============================================

// Generator: crÃ©e le client TypeScript
// AprÃ¨s "npx prisma generate", on peut faire:
// import { PrismaClient } from '@prisma/client'
generator client {
  provider = "prisma-client-js"
}

// Datasource: connexion Ã  la base de donnÃ©es
// DATABASE_URL est dÃ©finie dans .env (ou variable Render)
// Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ğŸ‘¤ MODEL USER - Compte utilisateur
// ============================================
// Stocke les informations de connexion et identitÃ©
// C'est la table "maÃ®tre" - Avatar et Stats y sont liÃ©s

model User {
  // ID unique gÃ©nÃ©rÃ© automatiquement (format: cuid - compact unique id)
  // Exemple: "clh1234567890abcdef"
  id        String   @id @default(cuid())
  
  // Email de connexion - UNIQUE = pas de doublons possibles
  email     String   @unique
  
  // Mot de passe HASHÃ‰ (jamais en clair!)
  // On utilisera bcrypt pour hasher
  password  String
  
  // Nom d'affichage (optionnel avec ?)
  name      String?
  
  // Dates de crÃ©ation/modification automatiques
  createdAt DateTime @default(now())    // now() = date actuelle Ã  la crÃ©ation
  updatedAt DateTime @updatedAt         // @updatedAt = mÃ j auto Ã  chaque save

  // â”€â”€ RELATIONS â”€â”€
  // Un user a UN avatar (relation 1:1)
  // Le ? signifie que l'avatar peut ne pas encore exister
  avatar Avatar?
  
  // Un user a UNE ligne de stats (relation 1:1)
  stats  Stats?
  
  // Un user a PLUSIEURS quÃªtes (relation 1:N)
  quests Quest[]
  
  // Un user a PLUSIEURS habitudes (relation 1:N)
  habits Habit[]
  
  // Un user a PLUSIEURS entrÃ©es de journal (relation 1:N)
  journalEntries JournalEntry[]

  // @@map renomme la table en "users" (convention: pluriel, minuscule)
  @@map("users")
}

// ============================================
// ğŸ¦¸ MODEL AVATAR - Personnage du joueur
// ============================================
// L'avatar reprÃ©sente le "personnage" de l'utilisateur dans le jeu
// Il gagne de l'XP, monte de niveau, peut Ãªtre personnalisÃ©

model Avatar {
  id          String   @id @default(cuid())
  
  // ClÃ© Ã©trangÃ¨re vers User
  // @unique car relation 1:1 (un user = un avatar max)
  userId      String   @unique
  
  // Relation: lie cet avatar Ã  un User
  // onDelete: Cascade = si on supprime le User, l'Avatar est supprimÃ© aussi
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // â”€â”€ PROGRESSION â”€â”€
  // Nom du personnage choisi par l'utilisateur
  name        String   @default("Hero")
  
  // Niveau actuel (commence Ã  1)
  // Monte quand l'utilisateur atteint des paliers d'XP
  level       Int      @default(1)
  
  // Points d'expÃ©rience actuels
  // Ex: 100 XP pour niveau 2, 250 pour niveau 3, etc.
  experience  Int      @default(0)
  
  // Type d'avatar (pour l'apparence/classe)
  // "warrior", "mage", "healer", "rogue", etc.
  avatarType  String   @default("warrior")
  
  // â”€â”€ PERSONNALISATION â”€â”€
  // JSON flexible pour stocker l'apparence
  // Ex: { "hair": "black", "skin": "light", "outfit": "armor1" }
  // On utilise Json car la structure peut Ã©voluer sans migration
  appearance  Json     @default("{}")
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("avatars")
}

// ============================================
// ğŸ“Š MODEL STATS - Statistiques de vie
// ============================================
// Les stats reprÃ©sentent les diffÃ©rents aspects de la vie
// de l'utilisateur, faÃ§on jeu de rÃ´le (0-100 pour chaque)

model Stats {
  id        String   @id @default(cuid())
  
  // Lien vers l'utilisateur (1:1)
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // â”€â”€ STATS PRINCIPALES (Ã©chelle 0-100) â”€â”€
  
  // ğŸ’ª HEALTH - SantÃ© physique
  // Augmente: sport, sommeil, alimentation saine
  // Diminue: maladie, mauvaises habitudes
  health    Int      @default(50)
  
  // âš¡ ENERGY - Ã‰nergie mentale / motivation
  // Augmente: accomplissements, repos, mÃ©ditation
  // Diminue: stress, surmenage, procrastination
  energy    Int      @default(50)
  
  // ğŸ“š WISDOM - Connaissances & apprentissage
  // Augmente: lecture, cours, apprentissage de skills
  // Diminue: stagnation (dÃ©croit lentement si pas actif)
  wisdom    Int      @default(50)
  
  // ğŸ‘¥ SOCIAL - Relations & connexions
  // Augmente: sorties, appels, aider les autres
  // Diminue: isolation, conflits
  social    Int      @default(50)
  
  // ğŸ’° WEALTH - SantÃ© financiÃ¨re
  // Augmente: Ã©pargne, investissement, revenus
  // Diminue: dÃ©penses excessives, dettes
  wealth    Int      @default(50)
  
  // â”€â”€ STREAKS (sÃ©ries consÃ©cutives) â”€â”€
  
  // Nombre de jours consÃ©cutifs avec activitÃ©
  // Se remet Ã  0 si l'utilisateur skip un jour
  currentStreak Int  @default(0)
  
  // Record personnel de streak
  // Utile pour les achievements "streak de 30 jours"
  longestStreak Int  @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stats")
}

// ============================================
// âš”ï¸ MODEL QUEST - QuÃªtes et dÃ©fis
// ============================================
// Une quÃªte est un objectif que l'utilisateur se fixe.
// ComplÃ©ter une quÃªte donne de l'XP et peut modifier les stats.

model Quest {
  id          String   @id @default(cuid())
  
  // Lien vers l'utilisateur propriÃ©taire
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // â”€â”€ INFORMATIONS DE BASE â”€â”€
  title       String              // "Faire 30 min de sport"
  description String?             // Description dÃ©taillÃ©e (optionnel)
  
  // â”€â”€ CATÃ‰GORIE â”€â”€
  // LiÃ© Ã  quelle stat? Permet de savoir quelle stat augmenter
  category    QuestCategory @default(GENERAL)
  
  // â”€â”€ DIFFICULTÃ‰ & RÃ‰COMPENSES â”€â”€
  // Plus c'est difficile, plus Ã§a rapporte
  difficulty  QuestDifficulty @default(MEDIUM)
  xpReward    Int             @default(25)    // XP gagnÃ©s Ã  la complÃ©tion
  statBoost   Int             @default(2)     // Points de stat gagnÃ©s
  
  // â”€â”€ Ã‰TAT â”€â”€
  status      QuestStatus @default(ACTIVE)
  
  // â”€â”€ Ã‰CHÃ‰ANCE (optionnel) â”€â”€
  dueDate     DateTime?           // Date limite
  
  // â”€â”€ TIMESTAMPS â”€â”€
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  completedAt DateTime?           // Quand la quÃªte a Ã©tÃ© complÃ©tÃ©e

  @@map("quests")
  // Index pour rÃ©cupÃ©rer rapidement les quÃªtes d'un user
  @@index([userId, status])
}

// â”€â”€ ENUMS â”€â”€

// CatÃ©gories de quÃªtes (liÃ©es aux stats)
enum QuestCategory {
  HEALTH    // ğŸ’ª SantÃ© physique
  ENERGY    // âš¡ Ã‰nergie mentale, motivation
  WISDOM    // ğŸ“š Apprentissage, lecture
  SOCIAL    // ğŸ‘¥ Relations, sorties
  WEALTH    // ğŸ’° Finances, travail
  GENERAL   // â­ GÃ©nÃ©ral (pas de stat spÃ©cifique)
}

// Niveaux de difficultÃ©
enum QuestDifficulty {
  EASY      // Facile: 15 XP, +1 stat
  MEDIUM    // Moyen: 25 XP, +2 stat
  HARD      // Difficile: 50 XP, +5 stat
  EPIC      // Ã‰pique: 100 XP, +10 stat
}

// Ã‰tats d'une quÃªte
enum QuestStatus {
  ACTIVE      // En cours
  COMPLETED   // TerminÃ©e avec succÃ¨s
  FAILED      // Ã‰chouÃ©e (deadline passÃ©e)
  ABANDONED   // AbandonnÃ©e par l'utilisateur
}

// ============================================
// ğŸ”„ MODEL HABIT - Habitudes rÃ©currentes
// ============================================
// Une habitude est une action rÃ©pÃ©tÃ©e rÃ©guliÃ¨rement.
// Contrairement aux quÃªtes (one-shot), les habitudes se rÃ©initialisent.

model Habit {
  id          String   @id @default(cuid())
  
  // Lien vers l'utilisateur
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // â”€â”€ INFORMATIONS DE BASE â”€â”€
  title       String              // "MÃ©diter 10 minutes"
  description String?             // Description optionnelle
  icon        String   @default("â­")  // Emoji pour affichage
  
  // â”€â”€ CATÃ‰GORIE (mÃªme que quÃªtes) â”€â”€
  category    QuestCategory @default(GENERAL)
  
  // â”€â”€ FRÃ‰QUENCE â”€â”€
  frequency   HabitFrequency @default(DAILY)
  
  // Pour WEEKLY: quels jours? (stockÃ© en JSON: [1,3,5] = Lun, Mer, Ven)
  // 0=Dim, 1=Lun, 2=Mar, 3=Mer, 4=Jeu, 5=Ven, 6=Sam
  targetDays  Json     @default("[]")
  
  // Combien de fois par pÃ©riode? (ex: 3 fois par semaine)
  targetCount Int      @default(1)
  
  // â”€â”€ RÃ‰COMPENSES (plus petites que les quÃªtes car rÃ©currentes) â”€â”€
  xpReward    Int      @default(10)   // XP par complÃ©tion
  statBoost   Int      @default(1)    // Stat boost par complÃ©tion
  
  // â”€â”€ Ã‰TAT â”€â”€
  isActive    Boolean  @default(true)  // Habitude activÃ©e?
  
  // â”€â”€ PROGRESSION â”€â”€
  currentStreak   Int  @default(0)    // Jours consÃ©cutifs
  longestStreak   Int  @default(0)    // Record personnel
  totalCompletions Int @default(0)    // Total depuis crÃ©ation
  
  // â”€â”€ TIMESTAMPS â”€â”€
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Logs de complÃ©tion
  logs        HabitLog[]

  @@map("habits")
  @@index([userId, isActive])
}

// ============================================
// ğŸ“‹ MODEL HABITLOG - Historique des complÃ©tions
// ============================================
// Chaque fois qu'une habitude est complÃ©tÃ©e, on crÃ©e un log.
// Permet de voir l'historique et calculer les streaks.

model HabitLog {
  id          String   @id @default(cuid())
  
  // Lien vers l'habitude
  habitId     String
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  
  // Date de complÃ©tion (sans l'heure, pour grouper par jour)
  completedDate DateTime @db.Date
  
  // Heure exacte de complÃ©tion
  completedAt   DateTime @default(now())
  
  // Note optionnelle
  note        String?

  @@map("habit_logs")
  // Un seul log par habitude par jour
  @@unique([habitId, completedDate])
  @@index([habitId, completedDate])
}

// â”€â”€ ENUM FRÃ‰QUENCE â”€â”€

enum HabitFrequency {
  DAILY       // Tous les jours
  WEEKLY      // Certains jours de la semaine
  WEEKDAYS    // Lun-Ven seulement
  WEEKENDS    // Sam-Dim seulement
}

// ============================================
// ğŸ““ MODEL JOURNALENTRY - Journal personnel
// ============================================
// EntrÃ©es de journal pour l'introspection quotidienne.
// Permet de rÃ©flÃ©chir sur ses Ã©motions, gratitudes, objectifs.

model JournalEntry {
  id          String   @id @default(cuid())
  
  // Lien vers l'utilisateur
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // â”€â”€ DATE â”€â”€
  // Date de l'entrÃ©e (une entrÃ©e par jour max)
  entryDate   DateTime @db.Date
  
  // â”€â”€ CONTENU â”€â”€
  // Humeur du jour (1-5)
  mood        Int      @default(3)
  
  // Texte principal du journal
  content     String?  @db.Text
  
  // Gratitudes (stockÃ©es en JSON pour flexibilitÃ©)
  // Ex: ["Ma famille", "Le beau temps", "Un bon cafÃ©"]
  gratitudes  Json     @default("[]")
  
  // Objectif du jour
  dailyGoal   String?
  
  // RÃ©flexion/leÃ§on apprise
  reflection  String?  @db.Text
  
  // Tags/thÃ¨mes (JSON array)
  tags        Json     @default("[]")
  
  // â”€â”€ RÃ‰COMPENSE â”€â”€
  // Ã‰crire dans son journal donne un petit bonus XP
  xpAwarded   Boolean  @default(false)
  
  // â”€â”€ TIMESTAMPS â”€â”€
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("journal_entries")
  // Une seule entrÃ©e par jour par utilisateur
  @@unique([userId, entryDate])
  @@index([userId, entryDate])
}

// â”€â”€ ENUM MOOD â”€â”€
// Note: On utilise Int (1-5) plutÃ´t qu'un enum pour plus de flexibilitÃ©
