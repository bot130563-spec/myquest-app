# ==========================================
# ðŸš€ RENDER BLUEPRINT - Infrastructure as Code
# ==========================================
#
# Ce fichier dÃ©finit l'infrastructure sur Render.com
# Il crÃ©e automatiquement:
# - Un service web (API backend)
# - Une base de donnÃ©es PostgreSQL
#
# UTILISATION:
# 1. Push ce repo sur GitHub
# 2. Va sur dashboard.render.com
# 3. New > Blueprint
# 4. Connecte ton repo GitHub
# 5. Render crÃ©e tout automatiquement!
#
# ALTERNATIVE MANUELLE:
# Si tu prÃ©fÃ¨res crÃ©er les services Ã  la main,
# voir le fichier RENDER-SETUP.md

# ============================================
# ðŸ—„ï¸ BASE DE DONNÃ‰ES POSTGRESQL
# ============================================
databases:
  - name: myquest-db                    # Nom affichÃ© dans Render
    databaseName: myquest               # Nom de la base
    user: myquest_user                  # Utilisateur DB
    
    # Plan: free = gratuit mais limitÃ©
    # - 256 MB stockage
    # - Expire aprÃ¨s 90 jours sans activitÃ©
    # Passer Ã  "starter" ($7/mois) pour production
    plan: free
    
    # RÃ©gion: Frankfurt (plus proche de la Suisse)
    region: frankfurt

# ============================================
# ðŸŒ SERVICE WEB - API BACKEND
# ============================================
services:
  - type: web                           # Type de service
    name: myquest-api                   # Nom affichÃ©
    runtime: node                       # Runtime Node.js
    region: frankfurt                   # MÃªme rÃ©gion que la DB
    
    # Plan gratuit: 750h/mois, sleep aprÃ¨s 15min inactivitÃ©
    plan: free
    
    # Dossier contenant le code backend
    rootDir: backend
    
    # â”€â”€ COMMANDES â”€â”€
    # Build: installer deps + gÃ©nÃ©rer client Prisma + compiler TS
    buildCommand: npm install && npx prisma generate && npm run build
    
    # Start: lancer le serveur compilÃ©
    startCommand: npm start
    
    # â”€â”€ HEALTH CHECK â”€â”€
    # Render ping cette URL pour vÃ©rifier que l'app est up
    healthCheckPath: /health
    
    # â”€â”€ VARIABLES D'ENVIRONNEMENT â”€â”€
    envVars:
      # NODE_ENV: production active les optimisations
      - key: NODE_ENV
        value: production
      
      # DATABASE_URL: Render injecte automatiquement l'URL de la DB
      # Le "fromDatabase" lie ce service Ã  la DB crÃ©Ã©e ci-dessus
      - key: DATABASE_URL
        fromDatabase:
          name: myquest-db
          property: connectionString
      
      # JWT_SECRET: clÃ© secrÃ¨te pour signer les tokens
      # "generateValue: true" = Render gÃ©nÃ¨re une valeur alÃ©atoire sÃ©curisÃ©e
      - key: JWT_SECRET
        generateValue: true
      
      # PORT: Render dÃ©finit automatiquement le port
      # Pas besoin de le spÃ©cifier, on utilise process.env.PORT
    
    # â”€â”€ AUTO-DEPLOY â”€â”€
    # RedÃ©ploie automatiquement quand tu push sur main
    autoDeploy: true
    
    # â”€â”€ BRANCHE â”€â”€
    # Quelle branche dÃ©clenche le dÃ©ploiement
    branch: main

# ============================================
# ðŸ“ NOTES
# ============================================
#
# APRÃˆS DÃ‰PLOIEMENT:
# 1. Va dans le dashboard Render
# 2. Clique sur myquest-api
# 3. RÃ©cupÃ¨re l'URL (ex: https://myquest-api.onrender.com)
# 4. Configure cette URL dans l'app frontend
#
# MIGRATIONS DB:
# Les migrations ne sont pas auto-exÃ©cutÃ©es.
# Pour la premiÃ¨re fois:
# 1. Va dans myquest-api > Shell
# 2. ExÃ©cute: npx prisma migrate deploy
#
# LOGS:
# Dashboard > myquest-api > Logs
# Utile pour dÃ©bugger les erreurs
#
# UPGRADE:
# Pour passer en production:
# - DB: Changer plan: free â†’ plan: starter ($7/mois)
# - API: Changer plan: free â†’ plan: starter ($7/mois)
# Le plan starter n'a pas de sleep et plus de ressources
